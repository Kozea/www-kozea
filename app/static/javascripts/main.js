// Generated by CoffeeScript 1.6.3
var lock_scroll, prevent_flickering, scrollTo, unlock_scroll;

$(function() {
  var init_address_history, init_click_handlers, init_responsive_menu, lock, position, slider;
  position = $("#switch");
  lock = false;
  init_address_history = function() {
    $('a').click(function(e) {
      $.address.value($(this).attr('href'));
    });
    $.address.externalChange(function(e) {
      if (e.value === '/#' || e.value === '/') {
        slider.goToSlide(0);
        unlock_scroll();
        scrollTo(0);
      }
      $('[href=' + e.value.replace('/', '') + ']').trigger('click');
    });
  };
  init_responsive_menu = function() {
    if ($(document).scrollTop() > position.offset().top + position.height()) {
      $("#main-menu").addClass('fixed');
    }
    $('.nav li a').click(function(e) {
      var href, timeanimation;
      slider.goToSlide(0);
      href = $(this).attr('href');
      if ($('body').hasClass('stop-scrolling')) {
        timeanimation = true;
      }
      unlock_scroll();
      if (timeanimation) {
        setTimeout(function() {
          scrollTo($(href).offset().top - 82);
        }, 700);
      } else {
        scrollTo($(href).offset().top - 82);
      }
      timeanimation = false;
      e.preventDefault();
    });
    $(document).on('scroll', function() {
      if ($(document).scrollTop() < position.offset().top + position.height()) {
        $("#main-menu").removeClass('fixed');
      } else {
        $("#main-menu").addClass('fixed');
      }
    });
    $(window).bind('load resize', function() {
      if ((matchMedia('all and (max-width: 970px)').matches)) {
        if ($('.nav.menu').is(':visible')) {
          if (!lock) {
            $('.nav.menu').hide();
            lock = true;
          }
        }
      } else {
        if ($('.nav.menu').is(':hidden')) {
          $('.nav.menu').show();
        }
        lock = false;
      }
    });
    $('#navigation-dropdown').on('click', function() {
      $('#main-header-link').hide();
      $(this).toggleClass('active');
      if ($('.nav.menu').is(':visible')) {
        $('#main-header-link').hide();
        $('.nav.menu').slideUp();
      } else {
        $('.nav.menu').slideDown();
        $('#main-header-link').fadeIn(1000);
      }
    });
  };
  init_click_handlers = function() {
    $("#main-header-link-icon").click(function(e) {
      e.preventDefault();
      slider.goToSlide(0);
    });
    $('#web .more').click(function(e) {
      e.preventDefault();
      lock_scroll();
      scrollTo();
      slider.goToSlide($(this).data('slide'));
    });
    $('.backToFirstSlide').click(function(e) {
      e.preventDefault();
      slider.goToSlide(0);
      unlock_scroll();
    });
  };
  init_address_history();
  init_responsive_menu();
  init_click_handlers();
  slider = $('.bxslider').bxSlider({
    controls: false,
    pager: false,
    adaptiveHeight: true,
    useCSS: true
  });
});

scrollTo = function(position, speed) {
  if (position == null) {
    position = null;
  }
  if (speed == null) {
    speed = 500;
  }
  prevent_flickering();
  if (!position && position !== 0) {
    position = $($('.nav li a').eq(1).attr('href')).offset().top - 82;
  }
  $('html, body').animate({
    scrollTop: position
  }, speed, function() {
    $('body').off('mousewheel');
  });
};

lock_scroll = function() {
  $('body').addClass('stop-scrolling');
};

unlock_scroll = function() {
  $('body').removeClass('stop-scrolling');
};

prevent_flickering = function() {
  $('body').on('mousewheel', function(e) {
    e.preventDefault();
  });
};
