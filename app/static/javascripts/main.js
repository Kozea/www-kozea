// Generated by CoffeeScript 1.6.3
var lock_scroll, prevent_flickering, scrollTo, unlock_scroll,
  __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

$(function() {
  var i, init_address_history, init_click_handlers, init_responsive_menu, lock, position, slider, themelist;
  position = $("#switch");
  lock = false;
  $('.closeModal').click(function() {
    var modalid;
    modalid = "#" + $(this).closest('.modal').attr('id');
    $(modalid).modal('hide');
  });
  themelist = (function() {
    var _i, _ref, _results;
    _results = [];
    for (i = _i = 0, _ref = $('.modal').length; 0 <= _ref ? _i <= _ref : _i >= _ref; i = 0 <= _ref ? ++_i : --_i) {
      _results.push("#theme" + i);
    }
    return _results;
  })();
  init_address_history = function() {
    $(window).bind('statechange', function() {
      var hash;
      hash = History.getHash() || History.getState().hash;
      if (hash && hash !== '/') {
        $('a[href=#' + hash.replace(/[\.#\/]/g, '') + ']').eq(0).click();
      } else {
        slider.goToSlide(0);
        unlock_scroll();
        scrollTo(0);
      }
    });
    $('a[href!=http], a[href!=https]').click(function(e) {
      var href;
      if (e.originalEvent) {
        href = $(this).attr('href').replace(/[\.#\/]/g, '/');
        History.pushState(null, null, href);
      }
    });
  };
  init_responsive_menu = function() {
    if ($(document).scrollTop() > position.offset().top + position.height()) {
      $("#main-menu").addClass('fixed');
    }
    $('.nav li a').click(function(e) {
      var href;
      e.preventDefault();
      href = $(this).attr('href');
      unlock_scroll();
      slider.goToSlide(0);
      scrollTo($(href).offset().top - 82);
    });
    $(document).on('scroll', function() {
      if ($(document).scrollTop() < position.offset().top + position.height()) {
        $("#main-menu").removeClass('fixed');
      } else {
        $("#main-menu").addClass('fixed');
      }
    });
    $(window).bind('load resize', function() {
      if ((matchMedia('all and (max-width: 970px)').matches)) {
        if ($('.nav.menu').is(':visible')) {
          if (!lock) {
            $('.nav.menu').hide();
            lock = true;
          }
        }
      } else {
        if ($('.nav.menu').is(':hidden')) {
          $('.nav.menu').show();
        }
        lock = false;
      }
    });
    $('#navigation-dropdown').click(function(e) {
      e.preventDefault();
      $('#main-header-link').hide();
      $(this).toggleClass('active');
      if ($('.nav.menu').is(':visible')) {
        $('#main-header-link').hide();
        $('.nav.menu').slideUp();
      } else {
        $('.nav.menu').slideDown();
        $('#main-header-link').fadeIn(1000);
      }
    });
  };
  init_click_handlers = function() {
    $("#main-header-link-icon").click(function(e) {
      e.preventDefault();
      slider.goToSlide(0);
    });
    $('#web .more').click(function(e) {
      e.preventDefault();
      lock_scroll();
      scrollTo();
      slider.goToSlide($(this).data('slide'));
    });
    $('.backToFirstSlide').click(function(e) {
      slider.goToSlide(0);
      unlock_scroll();
    });
  };
  slider = $('.bxslider').bxSlider({
    controls: false,
    pager: false,
    adaptiveHeight: true,
    useCSS: __indexOf.call(window, 'webkitRequestAnimationFrame') >= 0,
    touchEnabled: false,
    onSlideBefore: function(elem, oldindex, newindex) {
      if (newindex === 0) {
        scrollTo(0, 0);
      }
    }
  });
  init_responsive_menu();
  init_click_handlers();
  init_address_history();
});

scrollTo = function(position, speed) {
  if (position == null) {
    position = null;
  }
  if (speed == null) {
    speed = 500;
  }
  prevent_flickering();
  if (!position && position !== 0) {
    position = $($('.nav li a').eq(1).attr('href')).offset().top - 82;
  }
  $('html, body').animate({
    scrollTop: position
  }, speed, function() {
    $('body').off('mousewheel');
  });
};

lock_scroll = function() {
  $('body').addClass('stop-scrolling');
};

unlock_scroll = function() {
  $('body').removeClass('stop-scrolling');
};

prevent_flickering = function() {
  $('body').on('mousewheel', function(e) {
    e.preventDefault();
  });
};
